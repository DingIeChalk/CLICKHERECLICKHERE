<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Carter+One&display=swap" rel="stylesheet">
  <style>
    html, body {
      margin: 0;
      background: black;
      overflow: hidden;
      user-select: none;
    }

    #click-hint {
      font-family: 'Carter One', cursive;
      font-size: clamp(18px, 5vw, 24px);
      color: orange;
      position: absolute;
      transform: translate(-50%, -100%);
      z-index: 1000;
    }

    img.mrhuxbouncy {
      position: absolute;
      width: clamp(60px, 15vw, 120px);
      height: auto;
      padding: 12px;
      cursor: pointer;
      -webkit-user-drag: none;
    }

    .falling-text {
      position: fixed;
      font-family: 'Carter One', cursive;
      font-size: clamp(14px, 4vw, 24px);
      color: orange;
      pointer-events: none;
      z-index: 9998;
      animation: fall 5s linear forwards;
    }

    @keyframes fall {
      from { transform: translateY(0) rotate(var(--start-angle)); }
      to   { transform: translateY(120vh) rotate(var(--end-angle)); }
    }

    #debug {
      position: fixed;
      top: 0;
      left: 0;
      color: lime;
      font-family: monospace;
      padding: 6px 10px;
      z-index: 10001;
    }

    #build-timestamp {
      position: fixed;
      bottom: 10px;
      right: 10px;
      font-family: monospace;
      font-size: 12px;
      color: rgba(255,255,255,0.3);
      z-index: 9999;
    }
  </style>
</head>
<body>

  <div id="click-hint">CLICK HERE</div>
  <div id="debug">Loading...</div>
  <audio id="bgm" autoplay loop>
    <source src="https://raw.githubusercontent.com/DingIeChalk/CLICKHERECLICKHERE/main/Funk.mp3" type="audio/mpeg" />
  </audio>

  <script>
    const hint = document.getElementById("click-hint");
    const logos = [];
    let duplicateCount = 0;
    let jumpTimer = null;
    let fallingTextStarted = false;
    const phrases = [
      "BUY NOW!!", "LIMITED TIME OFFER!", "EVERY CLICK GUARANTEED!", "CHECK BACK OFTEN!",
      "TERMS & CONDITIONS APPLY*", "YOU CANâ€™T AFFORD NOT TO!", "THE BEST DEALS!!"
    ];

    function playClickSound() {
      const click = new Audio("https://raw.githubusercontent.com/DingIeChalk/CLICKHERECLICKHERE/main/Click.mp3");
      click.volume = 0.3;
      click.play();
    }

    function spawnFallingText() {
      const t = document.createElement("div");
      t.className = "falling-text";
      t.textContent = phrases[Math.floor(Math.random() * phrases.length)];
      t.style.left = Math.random() * 100 + "vw";
      t.style.setProperty('--start-angle', (Math.random() * 20 - 10) + "deg");
      t.style.setProperty('--end-angle', (Math.random() * 20 - 10) + "deg");
      document.body.appendChild(t);
      setTimeout(() => t.remove(), 5000);
    }

    function startFallingTextLoop() {
      if (fallingTextStarted) return;
      fallingTextStarted = true;
      (function loop() {
        spawnFallingText();
        setTimeout(loop, Math.random() * 8000 + 2000);
      })();
    }

    function createLogo(x = 100, y = 100, avoidDx = null, avoidDy = null) {
      const img = document.createElement("img");
      img.src = "https://raw.githubusercontent.com/DingIeChalk/CLICKHERECLICKHERE/main/mrhux.png";
      img.className = "mrhuxbouncy";
      img.draggable = false;
      document.body.appendChild(img);

      const speeds = [-3, -2, 2, 3];
      const dx = speeds.filter(v => v !== avoidDx)[Math.floor(Math.random() * 3)];
      const dy = speeds.filter(v => v !== avoidDy)[Math.floor(Math.random() * 3)];
      const logo = { el: img, x, y, dx, dy };
      logos.push(logo);

      img.addEventListener("click", e => {
        e.preventDefault();
        playClickSound();
        hint.style.display = "none";
        startFallingTextLoop();
        duplicateCount++;
        createLogo(logo.x + 20, logo.y + 20, dx, dy);
      });
    }

    function animate() {
      logos.forEach((logo, i) => {
        const el = logo.el;
        logo.x += logo.dx;
        logo.y += logo.dy;
        if (logo.x <= 0 || logo.x + el.width >= window.innerWidth) logo.dx *= -1;
        if (logo.y <= 0 || logo.y + el.height >= window.innerHeight) logo.dy *= -1;
        el.style.left = logo.x + "px";
        el.style.top = logo.y + "px";
        if (i === 0 && hint.style.display !== "none") {
          hint.style.left = (logo.x + el.width / 2) + "px";
          hint.style.top = logo.y + "px";
        }
      });
      requestAnimationFrame(animate);
    }

    createLogo();
    animate();

    document.addEventListener("click", function playMusicOnce() {
      const bgm = document.getElementById("bgm");
      bgm.volume = 0.25;
      if (bgm.paused) bgm.play();
      document.removeEventListener("click", playMusicOnce);
    });

    // Secret passphrase fetch & match
    let secretPhrase = null;
    let buffer = "";

    fetch("/api/secrets")
      .then(r => r.json())
      .then(data => {
        secretPhrase = data.secret;
        document.getElementById("debug").textContent = "Secret loaded. Type and press Enter.";
      })
      .catch(err => {
        document.getElementById("debug").textContent = "Error loading secret.";
        console.error(err);
      });

    document.addEventListener("keydown", e => {
      if (e.ctrlKey || e.metaKey) return; // prevent ctrl+backspace bug
      if (!secretPhrase) return;

      if (e.key === "Enter") {
        if (buffer === secretPhrase) {
          window.location.href = "/home";
        } else {
          document.getElementById("debug").textContent = "Incorrect phrase.";
        }
        buffer = "";
      } else if (e.key.length === 1) {
        buffer += e.key.toUpperCase();
        if (buffer.length > secretPhrase.length) {
          buffer = buffer.slice(-secretPhrase.length);
        }
      }

      document.getElementById("debug").textContent = `Buffer: ${buffer}`;
    });
  </script>

  <!-- LAST BUILD TIME DISPLAY (IN CST) -->
  <div id="build-timestamp">Last update: loading...</div>
  <script>
    fetch("https://api.github.com/repos/DingleChalk/CLICKHERECLICKHERE/commits/main")
      .then(r => r.json())
      .then(data => {
        const utc = new Date(data.commit.committer.date);
        const cst = new Date(utc.toLocaleString("en-US", { timeZone: "America/Chicago" }));
        document.getElementById("build-timestamp").textContent =
          "Last update: " + cst.toLocaleString("en-US", {
            weekday: "short", year: "numeric", month: "short",
            day: "numeric", hour: "2-digit", minute: "2-digit"
          });
      })
      .catch(() => {
        document.getElementById("build-timestamp").textContent = "Last update: unknown";
      });
  </script>

</body>
</html>
